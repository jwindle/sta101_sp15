% -*- TeX-engine: xetex; eval: (auto-fill-mode 0); eval: (visual-line-mode 1); -*-
% Compile with XeLaTeX

%%%%%%%%%%%%%%%%%%%%%%%
% To do before class
%%%%%%%%%%%%%%%%%%%%%%%

% Send the Logistics/Week0Annoucnement (the night before).
% Send an email reminding students to bring a charged computer (the night before).

%%%%%%%%%%%%%%%%%%%%%%%
% Option 1: Slides: (comment for handouts)   %
%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[slidestop,compress,mathserif,12pt,t,professionalfonts,xcolor=table]{beamer}

% solution stuff
\newcommand{\solnMult}[1]{
\only<1>{#1}
\only<2->{\red{\textbf{#1}}}
}
\newcommand{\soln}[1]{\textit{#1}}

\newcommand{\solnMultOn}[3]{
\only<#1>{#3}
\only<{#2}->{\red{\textbf{#3}}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Option 2: Handouts, without solutions (post before class)    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \documentclass[11pt,containsverbatim,handout,xcolor=xelatex,dvipsnames,table]{beamer}

% % handout layout
% \usepackage{pgfpages}
% \pgfpagesuselayout{4 on 1}[letterpaper,landscape,border shrink=5mm]

% % solution stuff
% \newcommand{\solnMult}[1]{#1}
% \newcommand{\soln}[1]{}
% \newcommand{\solnMultOn}[3]{#3}

% % % This breaks things for me for some reason.
% % tell pgfpages how to set page sizes in XeLaTeX
% %\renewcommand\pgfsetupphysicalpagesizes{%
% %   \pdfpagewidth\pgfphysicalwidth\pdfpageheight\pgfphysicalheight%
% %}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Option 3: Handouts, with solutions (may post after class if need be)    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \documentclass[11pt,containsverbatim,handout,xcolor=xelatex,dvipsnames,table]{beamer}

% % handout layout
% \usepackage{pgfpages}
% \pgfpagesuselayout{4 on 1}[letterpaper,landscape,border shrink=5mm]

% % solution stuff
% \newcommand{\solnMult}[1]{\red{\textbf{#1}}}
% \newcommand{\soln}[1]{\textit{#1}}

% % % This breaks things for me for some reason.
% % % tell pgfpages how to set page sizes in XeLaTeX
% % \renewcommand\pgfsetupphysicalpagesizes{%
% %    \pdfpagewidth\pgfphysicalwidth\pdfpageheight\pgfphysicalheight%
% % }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Option 4: Notes Only
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% % See http://tex.stackexchange.com/questions/114219/add-notes-to-latex-beamer
% \documentclass[10pt,containsverbatim,xcolor=xelatex,dvipsnames,table,notes=only]{beamer}

% % handout layout
% % \usepackage{pgfpages}
% % \pgfpagesuselayout{1 on 1}[letterpaper, landscape, border shrink=5mm]

% % solution stuff
% \newcommand{\solnMult}[1]{#1}
% \newcommand{\soln}[1]{}

% % % Having a problem with this.
% % tell pgfpages how to set page sizes in XeLaTeX
% % \renewcommand\pgfsetupphysicalpagesizes{%
% %   \pdfpagewidth\pgfphysicalwidth\pdfpageheight\pgfphysicalheight%
% %}

%%%%%%%%%%
% Load style file, defaults  %
%%%%%%%%%%

\input{../../lec_style.tex}
\input{../../definitions_default.tex}
% ALT ALT
%\input{../../definitions_custom.tex}

%%%%%%%%%%%
% Cover slide info    %
%%%%%%%%%%%

\title{Unit 5: Inference for categorical data}
\subtitle{1. Single sample proportion}
\author{Sta 101 - Spring 2015}
\date{March 17, 2015}
\institute{Duke University, Department of Statistical Science}

%%%%%%%%%%%
% Begin document   %
%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Title Page

\begin{frame}[plain]

\titlepage
\vfill
{\scriptsize \webLink{\PersonalSite}{Dr. \LastName{}} \hfill Slides posted at  \webLink{\CourseSite}{\CourseSite}}
\addtocounter{framenumber}{-1} 

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Housekeeping}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Announcements}

\begin{itemize}

\item whatever...

\end{itemize}

%---Note---%
\note{

Readiness Assessment 

4: Pooled proportion for standard error.

- Need to work on a good explantion here.

- When doing a confidence interval, why do we not worry about this?

5: Where else do this proportions come up?  Expected success/failure condition.

Use null value for hypothesis test.

9: Go through hypothesis test.

}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Main ideas}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{For inference on a single proportion: parameter is $p$ and point estimate is $\hat{p}$}
\label{mi1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{For inference on a single proportion...}

\begin{itemize}

\item parameter of interest, $p$: Proportion of ``success" in the population (unknown)

\item point estimate, $\hat{p}$: Proportion of ``success" in the sample

\end{itemize}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The CLT also describes the distribution of $\hat{p}$}
\label{mi2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Distribution of $\hat{p}$}

\hl{Central limit theorem for proportions:} Sample proportions will be nearly normally distributed with mean equal to the population mean, $p$, and standard error equal to $\sqrt{\frac{p~(1-p)}{n}}$.
\[ \hat{p} \sim N \pr{ mean = p, SE = \sqrt{\frac{p~(1-p)}{n}} } \]

Conditions:
\begin{itemize}
\item Independence: Random sample/assignment + 10\% rule
\item At least 10 successes and failures
\end{itemize}

%---Note---%
\note{

}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{}

\clicker{Suppose $p = 0.93$. What shape does the distribution of $\hat{p}$ have in random samples of $n = 100$.}

\begin{enumerate}[(a)]
\item unimodal and symmetric (nearly normal)
\item bimodal and symmetric
\item right skewed
\item \solnMult{left skewed}
\end{enumerate}

%---Note---%
\note{

- Correct mostly.

}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{}

\clicker{Suppose $p = 0.05$. What shape does the distribution of $\hat{p}$ have in random samples of $n = 100$.}

\begin{enumerate}[(a)]
\item unimodal and symmetric (nearly normal)
\item bimodal and symmetric
\item \solnMult{right skewed}
\item left skewed
\end{enumerate}

%---Note---%
\note{

- Somehow messed this up the first time.  Do again.

}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{}

\clicker{Suppose $p = 0.5$. What shape does the distribution of $\hat{p}$ have in random samples of $n = 100$.}

\begin{enumerate}[(a)]
\item \solnMult{unimodal and symmetric (nearly normal)}
\item bimodal and symmetric
\item right skewed
\item left skewed
\end{enumerate}

%---Note---%
\note{

- Mostly correct.

- Can I get some R code going?

}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{CI vs. HT determines observed vs. expected counts / proportions}
\label{mi3}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{CI vs. HT determines observed vs. expected counts / proportions}

Remember, when doing a HT always assume $H_0$ is true!
\pause

\begin{itemize}

\item \textbf{S-F:} Number of successes and failures for checking the success-failure condition for the nearly normal distribution of $\hat{p}$:
\pause
\begin{itemize}
\item CI: use observed proportion $\rightarrow$ $n\hat{p} \ge 10$ and $n(1 - \hat{p}) \ge 10$
\pause
\item HT: use null value of the proportion $\rightarrow$ $np_0 \ge 10$ and $n(1 - p_0) \ge 10$
\end{itemize}

\pause

\item \textbf{SE:} Proportion of success for calculating the standard error of $\hat{p}$: 
\[ SE = \sqrt{\frac{p(1-p)}{n}} \]
\pause
\vspace{-0.5cm}
\begin{itemize}
\item CI: use observed proportion $\rightarrow$ $SE = \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}$
\pause
\item HT: use null value of the proportion $\rightarrow$ $SE = \sqrt{\frac{p_0(1-p_0)}{n}}$
\end{itemize}

\end{itemize}

%---Note---%
\note{

When do you use phat vs p?

}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Only used CLT based methods if the sample size is large enough for a nearly normal sampling distribution}
\label{mi4}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Simulation vs. theoretical inference}

\begin{itemize}

\item If the S-F condition is met, can do theoretical inference: Z test, Z interval

\item If the S-F condition is not met, must use simulation based methods: randomization test, bootstrap interval

\end{itemize}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Applications}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Single population proportion, large sample}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}

\vfill

\clicker{Write out the digits of $\pi$ from memory. No cheating!}

\vfill

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}

\vfill

\app{App Ex 5.1}{See course website for details.}

\vfill

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Single population proportion, small sample}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}

\clicker{Are you left handed?}

\begin{enumerate}[(a)]
\item Yes
\item No
\end{enumerate}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}

\clicker{A variety of studies suggest that 8\% of college students are vegetarians. Assuming that this class is a representative sample of Duke students, which of the following are the correct set of hypotheses for testing if the proportion of Duke students who are vegetarian is different than the proportion of vegetarian college students at large.}

\begin{enumerate}[(a)]
\item \solnMult{$H_0: p = 0.08$; $H_A: p \ne 0.08$}
\item $H_0: p = 0.08$; $H_A: p < 0.08$
\item $H_0: \hat{p} = 0.08$; $H_A: \hat{p} \ne 0.08$
\item $H_0: \hat{p}_{Duke} = \hat{p}_{all~college}$; $H_A: \hat{p}_{Duke} \ne \hat{p}_{all~college}$
\item $H_0: p_{Duke} = p_{all~college}$; $H_A: p_{Duke} \ne p_{all~college}$
\end{enumerate}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Simulate by hand}

\disc{Describe a simulation scheme for this hypothesis test.}

\pause

\begin{itemize}
\item 100 chips in a bag: 8 green (vegetarian), 92 white (non vegetarian).
\pause
\item Sample randomly $n$ times from the bag, with replacement ($n$ = observed sample size)
\pause
\item Calculate $\hat{p}$, the proportion of greens (successes) in the random sample of size $n$, record this value.
\pause
\item Repeat many times.
\pause
\item Calculate the proportion of simulations where $\hat{p}$ is at least as different from 0.08 as the observed sample proportion.
\end{itemize}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}[fragile]
\frametitle{Simulate in R}

{\footnotesize
\begin{verbatim}
download("https://stat.duke.edu/~mc301/R/inference.RData", 
         destfile = "inference.RData")
load("inference.RData")

n_veg = [fill in based on class data]
n_nonveg = [fill in based on class data]

class_veg = c(rep("veg", n_veg), rep("non vegetarian", n_nonveg))

inference(class_veg, success = "veg", est = "proportion", 
          type = "ht", null = 0.08, alternative = "twosided", 
          method = "simulation")
\end{verbatim}
}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Bootstrap interval for a single proportion}

\vfill

\disc{How would the simulation scheme change for a bootstrap interval for the proportion of Duke students who are vegetarians?}

\vfill

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Recap}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Recap on CLT based methods}

\begin{itemize}

\item Calculating the necessary sample size for a CI with a given margin of error:
\begin{itemize}
\item If there is a previous study, use $\hat{p}$ from that study
\item If not, use $\hat{p} = 0.5$:
\begin{itemize}
\item if you don't know any better, 50-50 is a good guess
\pause
\item $\hat{p} = 0.5$ gives the most conservative estimate -- highest possible sample size
\end{itemize}
\end{itemize}

\item HT vs. CI for a proportion
\begin{itemize}

\item Success-failure condition:
\begin{itemize}
\item CI: At least 10 \red{observed} successes and failures
\item HT: At least 10 \red{expected} successes and failures, calculated using the null value
\end{itemize}

\item Standard error:
\begin{itemize}
\item CI: calculate using observed sample proportion: $SE = \sqrt{\frac{p(1-p)}{n}}$
\item HT: calculate using the null value: $SE = \sqrt{\frac{p_0(1-p_0)}{n}}$
\end{itemize}

\end{itemize}


\end{itemize}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Recap on simulation methods}

If the S-F condition is not met

\begin{itemize}

\item HT: Randomization test -- simulate under the assumption that $H_0$ is true, then find the p-value as proportion of simulations where the simulated $\hat{p}$ is at least as extreme as the one observed.

\item CI: Bootstrap interval -- resample with replacement from the original sample, and construct interval using percentile or standard error method.

\end{itemize}


\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Summary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Summary of main ideas}

\vfill

\begin{enumerate}

\item \nameref{mi1}

\item \nameref{mi2}

\item \nameref{mi3}

\item \nameref{mi4}

\end{enumerate}

\vfill

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}